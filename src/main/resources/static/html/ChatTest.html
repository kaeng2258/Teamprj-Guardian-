<!doctype html>
<html lang="ko">
<body>
<h3>STOMP 테스트</h3>
<div>
  <label>Room ID: <input id="roomId" value="1"></label>
  <button id="btnConnect">Connect & Subscribe</button>
</div>
<div>
  <label>Sender ID: <input id="senderId" value="1"></label>
  <label>Content: <input id="content" value="안녕하세요(STOMP)"></label>
  <button id="btnSend">Send</button>
</div>
<pre id="log"></pre>

<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
<script>
  let stompClient;

  const log = (m) => {
    document.getElementById('log').textContent += m + "\n";
  };

  document.getElementById('btnConnect').onclick = () => {
    const sock = new SockJS('http://localhost:8081/ws');
    stompClient = Stomp.over(sock);
    stompClient.connect({}, () => {
      const roomId = document.getElementById('roomId').value;
      stompClient.subscribe('/topic/room/' + roomId, (msg) => {
        log('[RECV] ' + msg.body);
      });
      log('Subscribed /topic/room/' + roomId);
    }, (err) => log('ERROR ' + err));
  };

  document.getElementById('btnSend').onclick = () => {
    const roomId = document.getElementById('roomId').value;
    const payload = {
      roomId: Number(roomId),
      senderId: Number(document.getElementById('senderId').value),
      content: document.getElementById('content').value,
      messageType: "TEXT",
      fileUrl: null
    };
    stompClient.send('/app/signal/' + roomId, {}, JSON.stringify(payload));
    log('[SEND] ' + JSON.stringify(payload));
  };
</script>
</body>
</html>
